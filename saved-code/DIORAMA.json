{"name":"Miniature faking","code":"var x1 = 320;\nvar y1 = 240;\nvar x2 = 320;\nvar y2 = 480;\n\nfunction process(input, output) {\n    var x, y;\n\n    var w = input.width;\n\tvar h = input.height;\n\tvar s = (w + h) * 2.0;\n\n\tvar dx = x2 - x1;\n\tvar dy = y2 - y1;\n\n\tvar sat = summedAreaTable(input);\n\n    for (y=0; y<output.height; y++) {\n    \tvar yt = y - y1;\n\n        for (x=0; x<output.width; x++) {\n            var xt = x - x1;\n\n\t\t\tvar r = (dx * xt + dy * yt) / s;\n\t\t\tvar ri = r < 0 ? -Math.floor(r) : Math.floor(r);\n\n\t\t\tvar yMin = Math.max(0, y - ri);\n\t\t\tvar yMax = Math.min(h, y + ri);\n\t\t\tvar bh = yMax - yMin;\n\n\t\t\tif (bh === 0) {\n\t\t\t    output[y][x].r = input[y][x].r;\n\t\t\t    output[y][x].g = input[y][x].g;\n\t\t\t    output[y][x].b = input[y][x].b;\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tvar xMin = Math.max(0, x - ri);\n\t\t\tvar xMax = Math.min(w, x + ri);\n\t\t\tvar scale = 1.0 / (xMax - xMin) / bh;\n\n\t\t\tsat.calculateArea(xMin, yMin, xMax, yMax, output[y][x]);\n\t\t\toutput[y][x].r *= scale;\n\t\t\toutput[y][x].g *= scale;\n\t\t\toutput[y][x].b *= scale;\n        }\n    }\n}\n\nvar sat;\nfunction summedAreaTable(image) {\n\tif (!sat)\n\t\tsat = newImage(image.width + 1, image.height + 1);\n\n\tvar x, y;\n\tfor (y = 0; y < image.height; y++) {\n\t\tfor (x = 0; x < image.width; x++) {\n\t\t\tsat[y + 1][x + 1].r = image[y][x].r + sat[y + 1][x].r + sat[y][x + 1].r - sat[y][x].r;\n\t\t\tsat[y + 1][x + 1].g = image[y][x].g + sat[y + 1][x].g + sat[y][x + 1].g - sat[y][x].g;\n\t\t\tsat[y + 1][x + 1].b = image[y][x].b + sat[y + 1][x].b + sat[y][x + 1].b - sat[y][x].b;\n\t\t}\n\t}\n\n\tsat.calculateArea = function(x1, y1, x2, y2, out) {\n\t\tvar A, B, C, D, r, g, b;\n\n\t\tA = this[y1][x1].r;\n\t\tB = this[y1][x2].r;\n\t\tC = this[y2][x2].r;\n\t\tD = this[y2][x1].r;\n\t\tout.r = A + C - B - D;\n\n\t\tA = this[y1][x1].g;\n\t\tB = this[y1][x2].g;\n\t\tC = this[y2][x2].g;\n\t\tD = this[y2][x1].g;\n\t\tout.g = A + C - B - D;\n\n\t\tA = this[y1][x1].b;\n\t\tB = this[y1][x2].b;\n\t\tC = this[y2][x2].b;\n\t\tD = this[y2][x1].b;\n\t\tout.b = A + C - B - D;\n\t};\n\n\treturn sat;\n}"}